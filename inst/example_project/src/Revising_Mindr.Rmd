---
title: "Rewriting_Mindr"
author: "Daniel Zhu"
date: "6/29/2018"
output: html_document
---
# Function to find any pound (#) signs located between the backticks (`) that signal the beginning and end of code and to remove them
## This is to ensure that those pound signs are not considered when creating the mindmap file
```{r}

fn <- '/Users/Daniel_Zhu_Account/Documents/summer2018/R_code/GraphIn/src/NetworkPlotOne.Rmd'
FindAll <- function(file) {
  input <- readLines(file)
  poundloc <- grep('^#+', input)
  bcktckloc <- grep('^```', input)
  
  f <- function(x){
     any(x >= bcktckloc[seq(1,length(bcktckloc), by=2)] & x <= bcktckloc[seq(2,length(bcktckloc), by=2)])
    
  }
  
  tobermv <- sapply(poundloc, f)
  
  rv <- input[poundloc[!tobermv]]
  return(rv)
}
input <- readLines(fn)

FindAll(fn)
```

```{r}
a<-bcktckloc[seq(1,length(bcktckloc), by=2)]
b<-bcktckloc[seq(2,length(bcktckloc), by=2)]
code <- NULL
for (x in 1:length(a)){
  code <- c(code,input[a[x]:b[x]])
  
}
realpndloc<-sapply(a, function(x) max(poundloc[poundloc<x]))
numpnd <- nchar(str_extract(input[realpndloc], '^#+'))
```

# Function to write the text for the mindmap file
```{r}
library(stringr)
input2 <- FindFPound(file)
#following value contains the number of pound signs in each line
pndloccnt <- nchar(str_extract(input2, '^#+'))
#following value takes the difference of the number of pound signs with the next value, and adds a 1 to ensure that the difference for the last set of pound sign is obtained.
pnddiff <- diff(c(pndloccnt,1))
mindmap <- '<map version ="1.0.1">'
title <- 'Display of Network Graph'

#function to insert beginning repeating section of mindmap files
startnode <- function(x, endnode=T){
  rv <- paste0('<node TEXT="', x, '">')
  if(endnode) rv <- paste0(rv, endnode())
  return(rv)
}

#function to insert ending repeating section of mindmap files
endnode <- function(n=1) {
  rv <- paste0(rep('</node>', n), collapse = '')
  return(rv)
}

#following two values are the next two lines for the mindmap file that still require manual input
mindmap[2] <- startnode(title, endnode=F)
mindmap[3] <- startnode(basename(fn), endnode=F)

#Prints the headers in R without the pound sign from the R code
realinput <- str_match(input2, '^#+ *(.+)')[,2]


#Where rest of the code is transformed from R code to XML 
for (x in 1:length(pnddiff)) {
  if (pnddiff[x] > 0){
    mindmap[x+3] <- startnode(realinput[x], endnode=F)
  }
  else if (pnddiff[x] == 0){
    mindmap[x+3] <- startnode(realinput[x], endnode=T)
  }
  else {
    mindmap[x+3] <- paste0(startnode(realinput[x], endnode=T), endnode(-pnddiff[x]), collapse='')
  }
}
#Puts in remaining ending nodes
mindmap[4+length(pnddiff)] <- paste0(endnode(2), '</map>')
# if(x > 3){
#   cat(x, "\n")
# }else if(x>1){
#   cat("I am between 1 and 3\n")
# }else{
#   cat("it is not big than 3\n")
# }
writeLines(mindmap,'Test.mm')
```

